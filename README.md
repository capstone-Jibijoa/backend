## ðŸ“„ ëª¨ë“ˆ ê´€ê³„ ë¶„ì„ 
### ðŸš€ í”„ë¡œì íŠ¸ ê°œìš”

ì´ í”„ë¡œì íŠ¸ëŠ” **FastAPI**ì™€ **LangChain**ì„ ê¸°ë°˜ìœ¼ë¡œ êµ¬ì¶•ëœ í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ ë° ë¶„ì„ APIìž…ë‹ˆë‹¤. ì‚¬ìš©ìžì˜ ìžì—°ì–´ ì¿¼ë¦¬ë¥¼ ë°›ì•„ ì •í˜• ë°ì´í„° í•„í„°ë§(PostgreSQL)ê³¼ ë¹„ì •í˜• ì˜ë¯¸ë¡ ì  ê²€ìƒ‰(Qdrant)ì„ ê²°í•©í•˜ì—¬ ê²°ê³¼ë¥¼ ë„ì¶œí•˜ê³ , LLM(Claude 3)ì„ í†µí•´ ê²°ê³¼ë¥¼ ì‹¬ì¸µ ë¶„ì„í•©ë‹ˆë‹¤.

### ðŸ§© ëª¨ë“ˆ ê´€ê³„ ë° ì—­í• 
í”„ë¡œì íŠ¸ì˜ í•µì‹¬ ëª¨ë“ˆë“¤ì€ ë‹¤ìŒê³¼ ê°™ì€ ì˜ì¡´ì„±ì„ ê°€ì§‘ë‹ˆë‹¤.

### main.py

- **ì—­í• **: FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì§„ìž…ì (Entry Point)ì´ìž ì „ì²´ ì›Œí¬í”Œë¡œìš°ë¥¼ ì¡°ìœ¨í•˜ëŠ” ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°.
- **ì£¼ìš” ê¸°ëŠ¥**: `/api/search` ì—”ë“œí¬ì¸íŠ¸ë¥¼ í†µí•´ ìš”ì²­ì„ ë°›ê³ , ê° ëª¨ë“ˆì˜ í•¨ìˆ˜ë¥¼ ìˆœì„œëŒ€ë¡œ í˜¸ì¶œí•˜ì—¬ ìµœì¢… ê²°ê³¼ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
- **ì˜ì¡´ì„±**: `hybrid_logic.py`, `langchain_search_logic.py`, `analysis_logic.py`, `db_logic.py` (ë¡œê·¸ ê¸°ë¡ìš©)

### hybrid_logic.py

- **ì—­í• **: ì‚¬ìš©ìž ì§ˆì˜(Query) ë¶„ì„ ë° ë³€í™˜ ë‹´ë‹¹.
- **ì£¼ìš” ê¸°ëŠ¥**: Claude 3 Sonnet ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ ìžì—°ì–´ ì§ˆì˜ë¥¼ **ì •í˜• í•„í„° ì¡°ê±´(JSON)**ê³¼ **ë¹„ì •í˜• ì˜ë¯¸ë¡ ì  ê²€ìƒ‰ì–´(Text)**ë¡œ ë¶„ë¦¬í•©ë‹ˆë‹¤.
- **ì˜ì¡´ì„±**: `langchain-anthropic`

### langchain_search_logic.py

- **ì—­í• **: **LangChain ê¸°ë°˜ì˜ í•µì‹¬ í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ ë¡œì§**ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.
- **ì£¼ìš” ê¸°ëŠ¥**: LangChain Expression Language(LCEL)ë¥¼ ì‚¬ìš©í•˜ì—¬ ê²€ìƒ‰ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•©ë‹ˆë‹¤. PostgreSQLì—ì„œ ì •í˜• í•„í„°ë§ì„ ìˆ˜í–‰í•˜ê³ , ê·¸ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ Qdrantì—ì„œ ë²¡í„° ê²€ìƒ‰ì„ ì‹¤í–‰í•˜ì—¬ ìµœì¢… ë°ì´í„° ëª©ë¡ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
- **ì˜ì¡´ì„±**: `langchain`, `db_logic.py` (DB ì—°ê²°ìš©)

### db_logic.py

- **ì—­í• **: ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ë° ë³´ì¡° ê¸°ëŠ¥ ì œê³µ.
- **ì£¼ìš” ê¸°ëŠ¥**: PostgreSQL ë° Qdrant í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ê°ì²´ë¥¼ ì œê³µí•˜ê³ , ê²€ìƒ‰ ë¡œê·¸ë¥¼ DBì— ê¸°ë¡í•˜ëŠ” í•¨ìˆ˜(`log_search_query`)ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.
- **ì˜ì¡´ì„±**: `psycopg2`, `qdrant-client`, `spl_queries.py`

### spl_queries.py

- **ì—­í• **: SQL ì¿¼ë¦¬ ì €ìž¥ì†Œ.
- **ì£¼ìš” ê¸°ëŠ¥**: `CREATE TABLE`ê³¼ ê°™ì€ ê³ ì • SQL êµ¬ë¬¸ì„ ë³€ìˆ˜ë¡œ ì €ìž¥í•©ë‹ˆë‹¤.
- **ì˜ì¡´ì„±**: ì—†ìŒ.

### analysis_logic.py

- **ì—­í• **: ê²€ìƒ‰ ê²°ê³¼ì— ëŒ€í•œ LLM ê¸°ë°˜ ì‹¬ì¸µ ë¶„ì„ ë‹´ë‹¹.
- **ì£¼ìš” ê¸°ëŠ¥**: `langchain_search_logic`ìœ¼ë¡œë¶€í„° ë°›ì€ ê²€ìƒ‰ ê²°ê³¼ë¥¼ Claude 3 Opus ëª¨ë¸ì— ì „ë‹¬í•˜ì—¬, ìš”ì•½ ë° ì‹œê°í™”ìš© ë¶„ì„ ë°ì´í„°ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.
- **ì˜ì¡´ì„±**: `langchain-anthropic`

### ðŸ—ºï¸ ëª¨ë“ˆ ê°„ ì˜ì¡´ì„± ìš”ì•½

`main.py` â”€â”€â”€â”€â”€â”¬â”€â”€> `hybrid_logic.py` (ì§ˆì˜ ë¶„ë¦¬)
             â”œâ”€> `langchain_search_logic.py` (í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰) â”€â”€> `db_logic.py` (ì—°ê²°) â”€â”€> `spl_queries.py`
             â”œâ”€> `analysis_logic.py` (ê²°ê³¼ ë¶„ì„)
             â””â”€> `db_logic.py` (ë¡œê·¸ ê¸°ë¡)

ì´ êµ¬ì¡°ëŠ” ê° ëª¨ë“ˆì˜ ì—­í• ì„ ëª…í™•ížˆ ë¶„ë¦¬í•˜ê³ , ìœ ì§€ë³´ìˆ˜ ë° í™•ìž¥ì„±ì„ ë†’ì´ëŠ” ë° ê¸°ì—¬í•©ë‹ˆë‹¤.

### ë¡œì§ íë¦„ (LangChain ê¸°ë°˜)
[ì‚¬ìš©ìž ì§ˆì˜] in `main.py`
     |
     v
`split_query_for_hybrid_search()` in `hybrid_logic.py` --> [ì •í˜• ì¡°ê±´(JSON)] & [ë¹„ì •í˜• í…ìŠ¤íŠ¸]
     |
     v
`langchain_hybrid_chain.invoke()` in `langchain_search_logic.py`
     |
     +--> 1. `_get_filtered_uids_from_postgres()` (PostgreSQLì—ì„œ UID í•„í„°ë§)
     +--> 2. `retriever.get_relevant_documents()` (Qdrantì—ì„œ í•„í„°ë§ëœ UIDë¡œ ë²¡í„° ê²€ìƒ‰)
     +--> 3. `_extract_payload_from_documents()` (Qdrant ê²°ê³¼ì—ì„œ ìµœì¢… ë°ì´í„° ì¶”ì¶œ)
     |
     v
[ìµœì¢… ê²€ìƒ‰ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸]

### ê°€ìƒí™˜ê²½ ê´€ë ¨ ì„¤ì •
í™œì„±í™” => .\venv\Scripts\activate
ë¹„í™œì„±í™” => deactivate

### API ì„œë²„ ì‹¤í–‰
uvicorn main:app --reload
