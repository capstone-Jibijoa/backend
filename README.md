## ðŸ“„ ëª¨ë“ˆ ê´€ê³„ ë¶„ì„ 
### ðŸš€ í”„ë¡œì íŠ¸ ê°œìš”

ì´ í”„ë¡œì íŠ¸ëŠ” FastAPI ê¸°ë°˜ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ, ì‚¬ìš©ìžì˜ ìžì—°ì–´ ì¿¼ë¦¬ë¥¼ ì²˜ë¦¬í•˜ê³  ë°ì´í„°ë² ì´ìŠ¤ì— ì €ìž¥ëœ ì •ë³´ì™€ ìƒí˜¸ìž‘ìš©í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ì‹œìŠ¤í…œì€ ëª…í™•í•œ ì—­í•  ë¶„ë‹´ì„ ìœ„í•´ ì—¬ëŸ¬ ëª¨ë“ˆë¡œ ë‚˜ë‰˜ì–´ ìžˆìŠµë‹ˆë‹¤.

### ðŸ§© ëª¨ë“ˆ ê´€ê³„ ë° ì—­í• 
í”„ë¡œì íŠ¸ì˜ í•µì‹¬ ëª¨ë“ˆë“¤ì€ ë‹¤ìŒê³¼ ê°™ì€ ì˜ì¡´ì„±ì„ ê°€ì§‘ë‹ˆë‹¤.

### main.py

ì—­í• : FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì§„ìž…ì (Entry Point)ìž…ë‹ˆë‹¤.
ì£¼ìš” ê¸°ëŠ¥: API ì—”ë“œí¬ì¸íŠ¸(/api/search ë“±)ë¥¼ ì •ì˜í•˜ê³ , ì „ì²´ ê²€ìƒ‰-ë¶„ì„ ì›Œí¬í”Œë¡œìš°ë¥¼ ì¡°ìœ¨í•˜ëŠ” ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°(Orchestrator) ì—­í• ì„ í•©ë‹ˆë‹¤.
ì˜ì¡´ì„±: `hybrid_logic.py`, `db_logic.py`, `analysis_logic.py`ì— ì˜ì¡´í•©ë‹ˆë‹¤.

### hybrid_logic.py

ì—­í• : ìžì—°ì–´ ì²˜ë¦¬ ë° AI ëª¨ë¸ ë¡œì§ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.
ì£¼ìš” ê¸°ëŠ¥: Claude 3 ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìž ì§ˆì˜ë¥¼ ì •í˜•/ë¹„ì •í˜• ì¡°ê±´ìœ¼ë¡œ ë¶„ë¦¬í•˜ê³ , KURE ìž„ë² ë”© ëª¨ë¸ì„ ì‚¬ìš©í•´ ë¹„ì •í˜• ì¡°ê±´ì„ ë²¡í„°ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
ì˜ì¡´ì„±: `anthropic`, `sentence-transformers` ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì˜ì¡´í•©ë‹ˆë‹¤.

### db_logic.py

ì—­í• : ë°ì´í„°ë² ì´ìŠ¤ ë° ë²¡í„° DB ê´€ë ¨ ë¡œì§ì„ ëª¨ë‘ ì²˜ë¦¬í•©ë‹ˆë‹¤.
ì£¼ìš” ê¸°ëŠ¥: PostgreSQLì—ì„œ ì •í˜• ë°ì´í„°ë¥¼ í•„í„°ë§í•˜ê³ , Qdrant ë²¡í„° DBì—ì„œ ì˜ë¯¸ë¡ ì  ê²€ìƒ‰ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ë‘ ê²°ê³¼ë¥¼ í†µí•©í•˜ì—¬ ìµœì¢… ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ë©°, ê²€ìƒ‰ ë¡œê·¸ë„ ê¸°ë¡í•©ë‹ˆë‹¤.
ì˜ì¡´ì„±: `psycopg2`, `qdrant-client` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©°, `spl_queries.py`ì—ì„œ SQL ì¿¼ë¦¬ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.

### spl_queries.py

ì—­í• : SQL ì¿¼ë¦¬ ì €ìž¥ì†Œìž…ë‹ˆë‹¤.
ì£¼ìš” ê¸°ëŠ¥: ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ìƒì„±ì„ ìœ„í•œ CREATE TABLE SQL êµ¬ë¬¸ì„ ë¬¸ìžì—´ ë³€ìˆ˜ë¡œ ì €ìž¥í•˜ê³  ì œê³µí•©ë‹ˆë‹¤.
ì˜ì¡´ì„±: ë‹¤ë¥¸ ëª¨ë“ˆì— ì˜ì¡´í•˜ì§€ ì•ŠëŠ” ë‹¨ìˆœ ë°ì´í„° ëª¨ë“ˆìž…ë‹ˆë‹¤.

### analysis_logic.py

ì—­í• : ê²€ìƒ‰ ê²°ê³¼ ë°ì´í„° ë¶„ì„ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.
ì£¼ìš” ê¸°ëŠ¥: `db_logic`ì„ í†µí•´ ì–»ì€ ìµœì¢… ë°ì´í„°ì…‹ì„ Claude 3 Opus ëª¨ë¸ì— ì „ë‹¬í•˜ì—¬, ì‚¬ìš©ìž ì§ˆì˜ì— ë§žëŠ” ì‹¬ì¸µ ë¶„ì„ ë¦¬í¬íŠ¸(ìš”ì•½, ì—°ê´€ í† í”½, ì‹œê°í™” ë°ì´í„° ë“±)ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
ì˜ì¡´ì„±: `anthropic` ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì˜ì¡´í•©ë‹ˆë‹¤.

### ðŸ—ºï¸ ëª¨ë“ˆ ê°„ ì˜ì¡´ì„± ìš”ì•½
ë‹¤ìŒì€ ê° ëª¨ë“ˆ ê°„ì˜ ì˜ì¡´ì„±ì„ ë„ì‹í™”í•œ ê²ƒìž…ë‹ˆë‹¤.

main.py â”€â”€â”€â”€â”€â”¬â”€â”€> hybrid_logic.py
             â”œâ”€â”€> db_logic.py â”€â”€â”€â”€â”€> spl_queries.py
             â””â”€â”€> analysis_logic.py

ì´ êµ¬ì¡°ëŠ” ê° ëª¨ë“ˆì˜ ì—­í• ì„ ëª…í™•ížˆ ë¶„ë¦¬í•˜ê³ , ìœ ì§€ë³´ìˆ˜ ë° í™•ìž¥ì„±ì„ ë†’ì´ëŠ” ë° ê¸°ì—¬í•©ë‹ˆë‹¤.

### ë¡œì§ íë¦„ (LangChain ê¸°ë°˜)
[ì‚¬ìš©ìž ì§ˆì˜] in `main.py`
     |
     v
`split_query_for_hybrid_search()` in `hybrid_logic.py` --> [ì •í˜• ì¡°ê±´] & [ë¹„ì •í˜• í…ìŠ¤íŠ¸]
     |
     v
`langchain_hybrid_chain.invoke()` in `langchain_search_logic.py`
     |
     +--> 1. `_get_filtered_uids_from_postgres()` (PGì—ì„œ UID í•„í„°ë§)
     +--> 2. `retriever.get_relevant_documents()` (Qdrantì—ì„œ ë²¡í„° ê²€ìƒ‰)
     +--> 3. `_get_final_data_from_postgres()` (PGì—ì„œ ìµœì¢… ë°ì´í„° ì¡°íšŒ)
     |
     v
[ìµœì¢… ê²€ìƒ‰ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸]

### ê°€ìƒí™˜ê²½ ê´€ë ¨ ì„¤ì •
í™œì„±í™” => .\venv\Scripts\activate
ë¹„í™œì„±í™” => deactivate

### API ì„œë²„ ì‹¤í–‰
uvicorn main:app --reload
